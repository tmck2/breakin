<html>
<head>
<link rel="stylesheet" type="text/css" href="styles.css" />
<link href="https://fonts.googleapis.com/css?family=Orbitron:900" rel="stylesheet">
<script>
  sounds = {}
  function playSound(filename, volume, loop) {
    if (sounds[filename] == undefined)
      sounds[filename] = new Audio(filename);
    snd = sounds[filename];
    snd.currentTime = 0;
    snd.volume = volume;
    snd.loop = loop;
    snd.play();
  }
  ct = 0;
  states = [];
  function saveState(state) {
    states[ct++] = state;
  }
  function getHighScore() {
    if (localStorage.highScore)
      return +localStorage.highScore;
    return 0;
  }
  function saveScoreIfNewBest(score) {
    best = getHighScore();
    if (score > best) {
      localStorage.highScore = score;
      app.ports.updateHighScore.send(score);
    }
  }
</script>
</head>
<div id="main"></div>
<script src="breakin.js"></script>
<script>
    var node = document.getElementById('main');
    var app = Elm.Main.embed(node);
    app.ports.playSound.subscribe(function (params) {
      var volume = params[0];
      var loop = params[1];
      var filename = params[2];
      playSound(filename, volume, loop);
    });
    app.ports.saveState.subscribe(function (state) {
      saveState(state);
    });
    app.ports.rewind.subscribe(function () {
      app.ports.updateModel.send(states[--ct]);
    });
    app.ports.fastforward.subscribe(function() {
      app.ports.updateModel.send(states[++ct]);
    });
    app.ports.saveHighScore.subscribe(function(score) {
      saveScoreIfNewBest(score);
    });
    app.ports.getHighScore.subscribe(function() {
      score = getHighScore();
      app.ports.updateHighScore.send(score);
    });
</script>
</html>
